"use strict";(self["webpackChunkFMAXC_WEB_VUE2"]=self["webpackChunkFMAXC_WEB_VUE2"]||[]).push([[886],{4886:function(e,t,s){s.r(t),s.d(t,{default:function(){return h}});var a=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{overflow:"hidden"}},[t("div",{staticClass:"card"},[t("div",{staticClass:"card-body"},[t("div",{staticClass:"card-title"},[t("h3",[t("font-awesome-icon",{attrs:{icon:["fas","users"]}}),e._v(" 用户列表")],1),t("hr")]),t("vs-table",{ref:"table",scopedSlots:e._u([{key:"header",fn:function(){return[t("vs-input",{attrs:{border:"",placeholder:"输入用户名"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})]},proxy:!0},{key:"thead",fn:function(){return[t("vs-tr",[t("vs-th",[t("vs-checkbox",{attrs:{indeterminate:e.selected.length==e.users.length},on:{change:function(t){e.selected=e.$vs.checkAll(e.selected,e.users)}},model:{value:e.allCheck,callback:function(t){e.allCheck=t},expression:"allCheck"}})],1),t("vs-th",[e._v(" 用户名 ")]),t("vs-th",[e._v(" 昵称 ")]),t("vs-th",[e._v(" 手机号 ")]),t("vs-th",[e._v(" 邮箱 ")]),t("vs-th",[e._v(" QQ ")])],1)]},proxy:!0},{key:"tbody",fn:function(){return e._l(e.$vs.getPage(e.users,e.page,e.max),(function(s,a){return t("vs-tr",{key:a,attrs:{data:s,"is-selected":!!e.selected.includes(s)}},[t("vs-td",{staticStyle:{width:"5%"},attrs:{checkbox:""}},[t("vs-checkbox",{attrs:{val:s},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],1),t("vs-td",[e._v(" "+e._s(s.uname)+" ")]),t("vs-td",[e._v(" "+e._s(s.nickname)+" ")]),t("vs-td",[e._v(" "+e._s(s.phone_number||"未绑定")+" ")]),t("vs-td",[e._v(" "+e._s(s.email||"未绑定")+" ")]),t("vs-td",[e._v(" "+e._s(s.qid||"未绑定")+" ")])],1)}))},proxy:!0},{key:"footer",fn:function(){return[t("vs-pagination",{attrs:{length:e.$vs.getLength(e.users,e.max)},model:{value:e.page,callback:function(t){e.page=t},expression:"page"}})]},proxy:!0}]),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}}),t("h5",{staticClass:"mt-4 fw-bold d-flex align-items-center"},[e._v(" 操作 "),t("span",{staticClass:"ms-2 text-danger"},[e._v("已选中 "+e._s(e.selected.length)+" 项")]),t("vs-button",{staticClass:"ms-auto text-nowrap",attrs:{icon:"",border:""},on:{click:e.refreshData}},[t("i",{staticClass:"bx bx-refresh"})])],1),t("hr"),t("div",{staticClass:"row"},[t("button",{directives:[{name:"wave",rawName:"v-wave"}],staticClass:"col-md btn btn-primary mb-3 me-3",attrs:{disabled:0==e.selected.length},on:{click:function(t){return e.changeData("pwd")}}},[t("font-awesome-icon",{attrs:{icon:["fas","lock"]}}),e._v(" 修改密码 ")],1),t("button",{directives:[{name:"wave",rawName:"v-wave"}],staticClass:"col-md btn btn-warning mb-3 me-3",attrs:{disabled:0==e.selected.length},on:{click:function(t){return e.changeData("qid")}}},[t("font-awesome-icon",{attrs:{icon:["fab","qq"]}}),e._v(" 绑定QQ ")],1),t("button",{directives:[{name:"wave",rawName:"v-wave"}],staticClass:"col-md btn btn-success mb-3 me-3",attrs:{disabled:0==e.selected.length},on:{click:function(t){return e.changeData("email")}}},[t("font-awesome-icon",{attrs:{icon:["fas","envelope"]}}),e._v(" 绑定邮箱 ")],1),t("button",{directives:[{name:"wave",rawName:"v-wave"}],staticClass:"col-md btn btn-danger mb-3 me-3",attrs:{disabled:0==e.selected.length},on:{click:function(t){return e.changeData("delete")}}},[t("font-awesome-icon",{attrs:{icon:["fas","trash"]}}),e._v(" 删除用户 ")],1)]),t("h5",{staticClass:"mt-2 text-center text-danger"},[e._v("数据无价 谨慎操作")]),t("hr"),t("h5",[e._v(" 操作进度 "),t("span",{staticClass:"fw-bold"},[t("span",{staticClass:"text-primary"},[e._v(e._s(e.progress.all))]),e._v(" | "),t("span",{staticClass:"text-success"},[e._v(e._s(e.progress.finish))]),e._v(" | "),t("span",{staticClass:"text-danger"},[e._v(e._s(e.progress.fail))])])]),t("div",{staticClass:"progress progress-bar-success",staticStyle:{height:"5px"}},[t("div",{staticClass:"progress-bar bg-success",style:`width: ${e.progress.all?e.progress.finish/e.progress.all*100:0}%;`,attrs:{role:"progressbar","aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":"52"}})])],1)]),t("div",{staticClass:"card mt-3"},[t("div",{staticClass:"card-body"},[t("div",{staticClass:"card-title"},[t("h3",[t("font-awesome-icon",{attrs:{icon:["fas","plus"]}}),e._v(" 添加用户 ")],1),t("hr")]),t("vs-input",{staticClass:"mb-3",attrs:{primary:"",laceholder:"用户名"},scopedSlots:e._u([e.newUser.uname?null:{key:"message-danger",fn:function(){return[e._v(" 必填项 ")]},proxy:!0}],null,!0),model:{value:e.newUser.uname,callback:function(t){e.$set(e.newUser,"uname",t)},expression:"newUser.uname"}}),t("vs-input",{staticClass:"mb-3",attrs:{danger:"",placeholder:"密码",type:"password"},scopedSlots:e._u([e.newUser.pwd?null:{key:"message-danger",fn:function(){return[e._v(" 必填项 ")]},proxy:!0}],null,!0),model:{value:e.newUser.pwd,callback:function(t){e.$set(e.newUser,"pwd",t)},expression:"newUser.pwd"}}),t("vs-input",{staticClass:"mb-3",attrs:{primary:"",placeholder:"昵称"},model:{value:e.newUser.nickname,callback:function(t){e.$set(e.newUser,"nickname",t)},expression:"newUser.nickname"}}),t("vs-input",{staticClass:"mb-3",attrs:{primary:"",placeholder:"手机号"},model:{value:e.newUser.phone_number,callback:function(t){e.$set(e.newUser,"phone_number",t)},expression:"newUser.phone_number"}}),t("vs-input",{staticClass:"mb-3",attrs:{primary:"",placeholder:"邮箱"},model:{value:e.newUser.email,callback:function(t){e.$set(e.newUser,"email",t)},expression:"newUser.email"}}),t("vs-input",{staticClass:"mb-3",attrs:{primary:"",placeholder:"QQ"},model:{value:e.newUser.qid,callback:function(t){e.$set(e.newUser,"qid",t)},expression:"newUser.qid"}}),t("button",{directives:[{name:"wave",rawName:"v-wave"}],staticClass:"btn btn-success w-100",on:{click:e.addUser}},[t("font-awesome-icon",{attrs:{icon:["fas","plus"]}}),e._v(" 添加用户 ")],1)],1)])])},n=[],r=s(8574),i=s.n(r),l=s(4187),c={name:"Manage",data(){return{search:"",page:1,max:10,allCheck:!1,users:[],selected:[],progress:{all:0,finish:0,fail:0},newUser:{uname:"",pwd:"",nickname:"",phone_number:"",email:"",qid:""}}},components:{},mounted(){this.refreshData()},methods:{async changeData(e){"pwd"===e?this.$swal({title:"请输入新密码",input:"password",inputPlaceholder:"新密码",inputValidator:e=>{if(!e)return"密码不能为空"},confirmButtonText:"确认",cancelButtonText:"取消",showCancelButton:!0}).then((t=>{t.isConfirmed&&this.batch(e,t.value,{success:"密码修改成功",danger:"密码修改失败"})})):"qid"===e?this.$swal({title:"请输入需要绑定的QQ号",input:"text",inputPlaceholder:"QQ号",inputValidator:e=>{if(!e)return"QQ号不能为空"},confirmButtonText:"确认",cancelButtonText:"取消",showCancelButton:!0}).then((t=>{t.isConfirmed&&t.isConfirmed&&this.batch(e,t.value,{success:"QQ号修改成功",danger:"QQ号修改失败"})})):"email"===e?this.$swal({title:"请输入新邮箱",input:"email",inputPlaceholder:"邮箱地址",confirmButtonText:"确认",cancelButtonText:"取消",showCancelButton:!0}).then((t=>{t.isConfirmed&&this.batch(e,t.value,{success:"设置成功",danger:"设置失败"})})):"delete"===e&&this.$swal({title:"确认删除？",confirmButtonText:"确认",cancelButtonText:"取消",showCancelButton:!0}).then((t=>{t.isConfirmed&&this.batch(e,t.value,{success:"删除成功",danger:"删除失败"})}))},async batch(e,t,s){this.progress.all=this.selected.length,this.progress.finish=0,this.progress.fail=0;for(let a=0;a<this.selected.length;a++)this.StartChangeData(e,this.selected[a].uname,t).then((e=>{e?(this.progress.finish=this.progress.finish+1,this.$toastx({type:"success",title:s.success}),this.refreshData()):(this.progress.fail=this.progress.fail+1,this.$toastx({type:"danger",title:s.danger}))}))},async StartChangeData(e,t,s){if("delete"!==e&&"pwd"!==e&&"qid"!==e&&"email"!==e)return this.$toastx({type:"danger",title:"无效操作"}),!1;const a=i().SHA256(e+s+t+"@wszb@").toString(i().enc.Hex),n=await(0,l.A)({method:"post",url:"a/setUser",data:{sign:a,operate:e,value:s,uname:t}});return 1===n.data.status||(n.data.msg&&this.$toastx({type:"warning",title:n.data.msg}),!1)},async addUser(){if(!this.newUser.uname||!this.newUser.pwd)return void this.$toastx({type:"warning",title:"请填写必要信息"});const e=await(0,l.A)({method:"post",url:"a/addUser",data:{...this.newUser,sign:i().SHA256(this.newUser.uname+this.newUser.nickname+this.newUser.phone_number+this.newUser.qid+this.newUser.pwd+this.newUser.email+"@wszb@").toString(i().enc.Hex)}});1===e.data.status?(this.$swal({icon:"success",title:e.data.msg}),this.refreshData()):this.$swal({icon:"error",title:e.data.msg})},async refreshData(){this.selected=[];const e=this.$vs.loading({target:this.$refs.table,text:"加载中..."});await(0,l.A)({method:"post",url:"a/getUserList"}).then((e=>{if(1!==e.data.status)throw new Error("获取用户列表失败");this.users=e.data.data})).catch((e=>{this.$toastx({type:"danger",title:"获取用户列表失败"}),console.log(e)})),e.close()}}},o=c,d=s(1656),u=(0,d.A)(o,a,n,!1,null,null,null),h=u.exports}}]);
//# sourceMappingURL=886.aa28771d.js.map