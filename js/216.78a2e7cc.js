"use strict";(self["webpackChunkFMAXC_WEB_VUE2"]=self["webpackChunkFMAXC_WEB_VUE2"]||[]).push([[216],{8612:function(t,s,a){a.d(s,{A:function(){return l}});var e=function(){var t=this,s=t._self._c;return s("div",{staticClass:"card-box-wrapper"},[s("div",{ref:"card",staticClass:"card out-card",class:`bg-${t.color||"primary"}`,on:{click:function(s){return t.$emit("click")}}},[t.type&&"normal"!==t.type?t._e():s("div",{staticClass:"card card-box-normal"},[s("div",{staticClass:"card-body p-3 d-flex align-items-center"},[s("span",{class:`b-avatar badge-light-${t.color||"primary"} rounded-circle`,staticStyle:{width:"60px",height:"60px"}},[s("span",{staticClass:"b-avatar-custom"},[t._t("icon")],2)]),s("div",{staticClass:"truncate ms-3 appcard-textarea"},[s("div",{staticClass:"d-flex align-items-center flex-wrap"},[t._t("title")],2),s("div",{staticClass:"d-none d-sm-block"},[t._t("description")],2)]),s("div",{staticClass:"appcard-btnarea"},[t._t("btnarea")],2)])]),"box"===t.type?s("div",{staticClass:"card card-box text-center"},[s("div",{staticClass:"card-body"},[s("span",{staticClass:"b-avatar mb-3 rounded-circle",class:`badge-light-${t.color||"primary"}`,staticStyle:{width:"60px",height:"60px"}},[s("span",{staticClass:"b-avatar-custom"},[t._t("icon")],2)]),s("div",{staticClass:"truncate"},[t._t("title")],2)])]):t._e()])])},i=[],r={name:"Card",props:["color","top","left","right","bottom","type"],mounted(){void 0!==this.top?this.$refs.card.style.paddingTop=this.top||".25rem":void 0!==this.left?this.$refs.card.style.paddingLeft=this.left||".25rem":void 0!==this.right?this.$refs.card.style.paddingRight=this.right||".25rem":void 0!==this.bottom&&(this.$refs.card.style.paddingBottom=this.bottom||".25rem"),void 0===this.top&&void 0===this.left&&void 0===this.right&&void 0===this.bottom&&(this.$refs.card.style.paddingTop=".25rem")}},o=r,n=a(1656),c=(0,n.A)(o,e,i,!1,null,"6356a68c",null),l=c.exports},2216:function(t,s,a){a.r(s),a.d(s,{default:function(){return u}});var e=function(){var t=this,s=t._self._c;return s("div",{staticClass:"row"},[s("div",{ref:"bindemail",staticClass:"card col-md me-3"},[s("div",{staticClass:"card-body"},[t._m(0),t.bind?t._e():s("div",[s("div",{staticClass:"d-flex align-items-start mb-3"},[s("vs-input",{attrs:{primary:"",placeholder:"请输入您的邮箱"},scopedSlots:t._u([{key:"icon",fn:function(){return[s("i",{staticClass:"bx bx-envelope"})]},proxy:!0},t.testEmail(t.form.email)&&t.form.email?null:{key:"message-danger",fn:function(){return[t._v(" 格式不正确 ")]},proxy:!0}],null,!0),model:{value:t.form.email,callback:function(s){t.$set(t.form,"email",s)},expression:"form.email"}}),s("button",{staticClass:"ms-2 btn btn-primary text-nowrap p-2 fw-bold",attrs:{disabled:!t.form.token||!t.testEmail(t.form.email)||!t.form.email||t.form.send},on:{click:t.sendCode}},[t._v("发送验证码"+t._s(0===t.form.wait?"":` (${t.form.wait})`))])],1),s("KgCaptcha",{ref:"KgCaptchaVc",staticClass:"mt-3",attrs:{id:"emailCaptcha",handler:t.captchaPass}}),t.form.token?t._e():s("div",{staticClass:"vs-input__message vs-input__message--danger"},[t._v("请先完成人机验证")]),s("div",{staticClass:"mt-3"},[s("vs-input",{attrs:{danger:"",placeholder:"请输入验证码",disabled:!t.form.token||!t.form.send},scopedSlots:t._u([{key:"icon",fn:function(){return[s("i",{staticClass:"bx bx-check-shield"})]},proxy:!0},t.form.code?null:{key:"message-danger",fn:function(){return[t._v(" 必填项 ")]},proxy:!0}],null,!0),model:{value:t.form.code,callback:function(s){t.$set(t.form,"code",s)},expression:"form.code"}}),s("button",{staticClass:"mt-2 btn btn-success w-100",attrs:{disabled:!t.testEmail(t.form.email)||!t.form.email||!t.form.token||!t.form.send||!t.form.code},on:{click:t.bindEmail}},[t._v("绑定邮箱")])],1)],1),t.bind?s("div",[s("div",{staticClass:"d-flex flex-column"},[s("span",{staticClass:"text-success fs-5 fw-bold pb-2"},[s("StatusIcon",{attrs:{status:"success"}}),t._v(" 您的邮箱已完成绑定")],1),s("span",{staticClass:"text-secondary fw-bold py-2"},[s("i",{staticClass:"bx bxs-envelope"}),t._v(" "+t._s(t.$store.state.userData.user.info.email)+" ")]),s("button",{directives:[{name:"wave",rawName:"v-wave"}],staticClass:"mt-3 btn btn-danger",on:{click:t.unbindEmail}},[t._v("解除绑定")])])]):t._e()])]),s("div",{staticClass:"card col-md mt-md-0 mt-3"},[s("div",{staticClass:"card-body"},[t._m(1),s("Card",{staticClass:"w-100",attrs:{color:"danger"},scopedSlots:t._u([{key:"icon",fn:function(){return[s("font-awesome-icon",{attrs:{icon:["fas","circle-exclamation"]}})]},proxy:!0},{key:"title",fn:function(){return[s("h4",{staticClass:"font-weight-bolder m-0 text-nowrap"},[t._v("暂停服务")])]},proxy:!0}])})],1)])])},i=[function(){var t=this,s=t._self._c;return s("div",{staticClass:"card-title"},[s("h3",[t._v("绑定邮箱")]),s("hr")])},function(){var t=this,s=t._self._c;return s("div",{staticClass:"card-title"},[s("h3",[t._v("绑定手机")]),s("hr")])}],r=a(8612),o=a(675),n=a(1231),c=a(7363),l=a(6853),d={name:"EmailPhone",data(){return{form:{wait:0,uname:"",email:"",code:"",send:!1,token:""},timer:null}},components:{Card:r.A,KgCaptcha:o.A,StatusIcon:n.A},computed:{bind(){return!!this.$store.state.userData.user.info.email}},methods:{async sendCode(){if(!this.testEmail(this.form.email)||!this.form.email||!this.form.token||this.form.send)return;const t=this.$vs.loading({target:this.$refs.bindemail,text:"发送中..."}),s=await(0,c.Re)({email:this.form.email,verify:{tk:this.form.token}});1===s.status?(this.$swal({icon:"success",title:"发送成功",text:"验证码已发送至您的邮箱，请重新完成人机验证"}),this.resetCaptcha(),this.form.send=!0,this.openTimer()):(this.$swal({icon:"error",title:"发送失败",text:s.msg}),this.resetCaptcha()),t.close()},async bindEmail(){if(!this.testEmail(this.form.email)||!this.form.email||!this.form.token||!this.form.send||!this.form.code)return;const t=this.$vs.loading({target:this.$refs.bindemail,text:"绑定中..."}),s=await(0,c.Re)({email:this.form.email,verify:{tk:this.form.token},code:this.form.code});1===s.status?(this.$swal({icon:"success",title:"绑定成功",text:"您的邮箱已绑定"}),await(0,l.A)(!0)):(this.$swal({icon:"error",title:"绑定失败",text:s.msg}),this.resetCaptcha()),t.close()},async unbindEmail(){await this.$swal({icon:"warning",title:"解除绑定",text:"您确定要解除绑定吗？",showCancelButton:!0,confirmButtonText:"确认",cancelButtonText:"取消"}).then((async t=>{if(t.isConfirmed){const t=this.$vs.loading({target:this.$refs.bindemail,text:"解绑中..."}),s=await(0,c.mD)();1===s.status?(await(0,l.A)(!0),this.$swal({icon:"success",title:"解除成功",text:"您的邮箱已解除绑定"})):(this.$swal({icon:"error",title:"解除失败",text:s.msg}),this.resetCaptcha()),t.close()}}))},resetCaptcha(){this.$refs.KgCaptchaVc.reset(),this.form.token=""},testEmail(t){let s=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;return!!s.test(t)},captchaPass(t,s){"success"===s&&(this.form.token=t.token)},openTimer(){this.form.wait=60,this.timer=setInterval((()=>{this.form.wait--,this.form.wait<=0&&(this.form.wait=0,this.form.send=!1,clearInterval(this.timer))}),1e3)}}},m=d,f=a(1656),h=(0,f.A)(m,e,i,!1,null,null,null),u=h.exports}}]);
//# sourceMappingURL=216.78a2e7cc.js.map